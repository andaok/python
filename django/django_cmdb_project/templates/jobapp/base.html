<!DOCTYPE html>
{% load staticfiles %}

<html lang="en">
    <head>
	
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="{% static 'images/favicon.ico' %}">

    <title>
	cmdb-job-{% block title_block %}{% endblock %}
    </title>

    <!-- Bootstrap core CSS -->
    <link href="{% static 'css/bootstrap.min.css'%}" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="{% static 'css/dashboard.css'%}" rel="stylesheet">

    <!-- for kendoui -->

    <script src="{% static 'kendoui/js/jquery.min.js' %}"></script> 
    <link rel="stylesheet" href="{% static 'kendoui/styles/kendo.common.min.css' %}" />
    <link rel="stylesheet" href="{% static 'kendoui/styles/kendo.default.min.css' %}" />
    <link rel="stylesheet" href="{% static 'kendoui/styles/kendo.default.mobile.min.css' %}" />
    <script src="{% static 'kendoui/js/kendo.core.min.js' %}"></script>
    <script src="{% static 'kendoui/js/kendo.ui.core.min.js' %}"></script>
    <script src="{% static 'kendoui/js/kendo.combobox.min.js' %}"></script>
    

    {% block extrahead_block %}
    {% endblock %}

    </head>

    <body>
    
    <!-- PART ONE -->
    <nav class="navbar navbar-toggleable-md navbar-inverse fixed-top bg-inverse">
	
      <button class="navbar-toggler navbar-toggler-right hidden-lg-up" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
	  
      <div class="collapse navbar-collapse" id="navbarsExampleDefault">
	  
        <ul class="navbar-nav mr-auto">
            <p><font color="#FF0000">作业控制</font></p>
        </ul>
		
        <div class="form-inline mt-2 mt-md-0">
			{% if user.is_authenticated %}
				<a href="{% url 'jobapp:logout'%}"><font color="#FF0000">Logout</font></a>
			{% else %}
				<a href="{% url 'jobapp:login'%}"><font color="#FF0000">Login</font></a>
			{% endif %}
	    </div>
		
      </div>

    </nav>

    <div class="container-fluid">
      <div class="row">
	  
	<!-- PART TWO -->
        <nav class="col-sm-3 col-md-2 hidden-xs-down bg-faded sidebar">
			{% block sidebar_block %}
                              <ul class="nav nav-pills flex-column">
                                <li class="nav-item">
                                  <a class="nav-link active" href="#">作业状态</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" href="{% url 'jobapp:index' %}"> - 作业概览</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" href="#"> - 已提交的作业</a>
                                </li>                                
                                <li class="nav-item">
                                  <a class="nav-link" href="#"> - 正运行的作业</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" href="#"> - 已完成的作业</a>
                                </li>
                                <li class="nav-item">
                                  <a class="nav-link" href="#"> - 失败的作业</a>
                                </li>   
                             </ul>
                             <hr/>
        <ul class="nav nav-pills flex-column">
				   <li class="nav-item">
				      <a class="nav-link active" href="#">配置管理</a>
				   </li>
           <li class="nav-item">
              <a class="nav-link" href="#select_target_cmdb" data-toggle="modal"> - CMDB目标选取</a>
           </li>
           <li class="nav-item">
              <a class="nav-link" href="#select_target_salt" data-toggle="modal"> - SALT目标选取</a>
           </li>
			  </ul>
			  <hr>

        <ul class="nav nav-pills flex-column">
           <li class="nav-item">
              <a class="nav-link active" href="#">分组管理</a>
           </li>
           <li class="nav-item">
              <a class="nav-link" href="#" data-toggle="modal"> - SALT分组设置</a>
           </li>
           <li class="nav-item">
              <a class="nav-link" href="#" data-toggle="modal"> - 自定义分组设置</a>
           </li>
        </ul>
        <hr>

			{% endblock %}
        </nav>
    
		<!-- PART THREE -->
        <main class="col-sm-9 offset-sm-3 col-md-10 offset-md-2 pt-3">
            {% block main_block %}
	          {% endblock %}           
        </main>
		
      </div>
    </div>

    <!-- popup box 1 start -->
    <div class="modal fade" id="select_target_cmdb" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h6 class="modal-title" id="myModalLabel">选取目标</h6>
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          </div>
          <div class="modal-body" id="ShowInfoDiv">
          
          <!-- select execute target for salt -->
          <div id="example">

            <div class="demo-section k-content">
                <ul id="fieldlist">
                    <li>
                        <label for="applications">业务</label>
                        <input id="applications" style="width: 100%;" />
                    </li>
                    <li>
                        <label for="sets">组</label>
                        <input id="sets" disabled="disabled" style="width: 100%;" />
                    </li>
                    <li>
                        <label for="modules">模块</label>
                        <input id="modules" disabled="disabled" style="width: 100%;" />
                    </li>
                </ul>
            </div>

            <style>
               #fieldlist {
                   margin: 0;
                   padding: 0;
               }
       
               #fieldlist li {
                   list-style: none;
                   padding-bottom: 1.5em;
                   text-align: left;
               }
       
               #fieldlist label {
                   display: block;
                   padding-bottom: .3em;
                   font-weight: bold;
                   text-transform: uppercase;
                   font-size: 12px;
               }
            </style>

            <script>
                $(document).ready(function() {
                    var applications = $("#applications").kendoComboBox({
                        filter: "contains",
                        placeholder: "Select App...",
                        dataTextField: "ApplicationName",
                        dataValueField: "ApplicationID",
                        dataSource: {
                            type: "json",
                            serverFiltering: true,
                            transport: {
                                read: "/jobapp/get_app_info"
                            }
                        }
                    }).data("kendoComboBox");

                    var sets = $("#sets").kendoComboBox({
                        autoBind: false,
                        cascadeFrom: "applications",
                        filter: "contains",
                        placeholder: "Select Group...",
                        dataTextField: "SetName",
                        dataValueField: "SetID",
                        dataSource: {
                            type: "json",
                            serverFiltering: true,
                            transport: {
                                read: "/jobapp/get_set_info"
                            }
                        }
                    }).data("kendoComboBox");

                    var modules = $("#modules").kendoComboBox({
                        autoBind: false,
                        cascadeFrom: "sets",
                        filter: "contains",
                        placeholder: "Select Module...",
                        dataTextField: "ModuleName",
                        dataValueField: "ModuleID",
                        dataSource: {
                            type: "json",
                            serverFiltering: true,
                            transport: {
                                read: "/jobapp/get_module_info"
                            }
                        }
                    }).data("kendoComboBox");


                    $("#get").click(function() {

                        var app = applications.value() + "_" +  applications.text()
                        var set = sets.value() + "_" + sets.text()
                        var module = modules.value() + "_" + modules.text()

                        location.href = "/jobapp/target_hosts_info?app="+app+"&"+"set="+set+"&"+"module="+module


                    });
                });
            </script>
</div>
          <!-- end-->


          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">取消</button>
            <button type="button" class="btn btn-primary" id="get">确认</button>
          </div>
        </div>
      </div>
   </div>
    <!-- popup box 1 end   --> 

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="{% static 'js/tether.min.js' %}"></script>
    <!-- <script src="{% static 'js/jquery.min.js' %}"></script> -->
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/jobapp.js' %}"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="{% static 'js/ie10-viewport-bug-workaround.js' %}"></script>
	  <script>
      $(function () { $("[data-toggle='tooltip']").tooltip(); });
    </script>
    </body>
</html>
